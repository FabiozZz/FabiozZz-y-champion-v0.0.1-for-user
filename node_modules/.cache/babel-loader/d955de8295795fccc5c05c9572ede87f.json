{"ast":null,"code":"import MockAdapter from \"axios-mock-adapter\";\nimport axios from \"axios\"; // {delayResponse:2000}\n\nconst mock = new MockAdapter(axios);\nconst user = {\n  fullName: 'Mr. FabiozZz Loucoster',\n  birthDay: '20/10/1989',\n  phone: '+79996569772',\n  email: 'fabiozzz.dev@gmail.com'\n};\nconst users = [{\n  fullName: 'Mr. FabiozZz Loucoster',\n  birthDay: '20/10/1989',\n  phone: '+79996569772',\n  email: 'fabiozzz.dev@gmail.com'\n}, {\n  fullName: 'Mr. FabiozZz Loucoster',\n  birthDay: '20/10/1989',\n  phone: '+79996569772',\n  email: 'fabiozzz.dev@gmail.com'\n}, {\n  fullName: 'Mr. FabiozZz Loucoster',\n  birthDay: '20/10/1989',\n  phone: '+79996569772',\n  email: 'fabiozzz.dev@gmail.com'\n}, {\n  fullName: 'Mr. FabiozZz Loucoster',\n  birthDay: '20/10/1989',\n  phone: '+79996569772',\n  email: 'fabiozzz.dev@gmail.com'\n}];\nmock.onPost('/auth/login').reply(200, {\n  user,\n  accessToken: 'TOKEN_ACC',\n  refreshToken: 'TOKEN_REF'\n});\nmock.onPost('/auth/register').reply(200, {\n  success: 'Ok'\n});\nmock.onPost('/auth/refresh').reply(200, {\n  user,\n  accessToken: 'TOKEN_ACC',\n  refreshToken: 'TOKEN_REs'\n});\nmock.onGet('/users').reply(200, {\n  users\n});\n/**\n * response на логин token & refreshToken\n */\n\nexport default class Api {\n  constructor(options = {}) {\n    this.client = options.client || axios.create();\n    this.token = options.token;\n    this.refreshToken = options.refreshToken;\n    this.refreshRequest = null;\n    this.client.interceptors.request.use(config => {\n      if (!this.token) {\n        return config;\n      }\n\n      const newConfig = {\n        headers: {},\n        ...config\n      };\n      newConfig.headers.Authorization = `Bearer ${this.token}`;\n      return newConfig;\n    }, e => Promise.reject(e));\n    this.client.interceptors.response.use(r => r, async error => {\n      this.refreshToken = localStorage.getItem('refresh_token');\n\n      if (!this.refreshToken || error.response.status !== 401 || error.config.retry) {\n        throw error;\n      }\n\n      if (!this.refreshRequest) {\n        this.refreshRequest = this.client.post(\"/auth/refresh\", {\n          refreshToken: this.refreshToken\n        });\n      }\n\n      const {\n        data\n      } = await this.refreshRequest;\n      this.token = data.token;\n      localStorage.setItem('refresh_token', data.refreshToken);\n      this.refreshToken = data.refreshToken;\n      const newRequest = { ...error.config,\n        retry: true\n      };\n      return this.client(newRequest);\n    });\n  }\n\n  async login({\n    login,\n    password\n  }) {\n    const {\n      data\n    } = await this.client.post(\"/auth/login\", {\n      login,\n      password\n    });\n    console.log('вызван логин ');\n    this.token = data.token;\n    localStorage.setItem('refresh_token', data.refreshToken);\n    this.refreshToken = localStorage.getItem('refresh_token');\n    return data.user;\n  }\n\n  logout() {\n    this.token = null;\n    this.refreshToken = null;\n    localStorage.removeItem('refresh_token');\n  }\n\n  async register(data = {}) {\n    return await this.client.post('/auth/register', data).then(r => r);\n  }\n\n  getUsers() {\n    return this.client(\"/users\").then(data => data);\n  }\n\n}","map":{"version":3,"sources":["/home/fabiozzz/www/react/y-champion/for-user/src/exampleApi/APIJWT.js"],"names":["MockAdapter","axios","mock","user","fullName","birthDay","phone","email","users","onPost","reply","accessToken","refreshToken","success","onGet","Api","constructor","options","client","create","token","refreshRequest","interceptors","request","use","config","newConfig","headers","Authorization","e","Promise","reject","response","r","error","localStorage","getItem","status","retry","post","data","setItem","newRequest","login","password","console","log","logout","removeItem","register","then","getUsers"],"mappings":"AAAA,OAAOA,WAAP,MAAwB,oBAAxB;AACA,OAAOC,KAAP,MAAkB,OAAlB,C,CAEA;;AACA,MAAMC,IAAI,GAAG,IAAIF,WAAJ,CAAgBC,KAAhB,CAAb;AACA,MAAME,IAAI,GAAG;AACTC,EAAAA,QAAQ,EAAC,wBADA;AAETC,EAAAA,QAAQ,EAAE,YAFD;AAGTC,EAAAA,KAAK,EAAE,cAHE;AAITC,EAAAA,KAAK,EAAE;AAJE,CAAb;AAMA,MAAMC,KAAK,GAAC,CACR;AACIJ,EAAAA,QAAQ,EAAC,wBADb;AAEIC,EAAAA,QAAQ,EAAE,YAFd;AAGIC,EAAAA,KAAK,EAAE,cAHX;AAIIC,EAAAA,KAAK,EAAE;AAJX,CADQ,EAOR;AACIH,EAAAA,QAAQ,EAAC,wBADb;AAEIC,EAAAA,QAAQ,EAAE,YAFd;AAGIC,EAAAA,KAAK,EAAE,cAHX;AAIIC,EAAAA,KAAK,EAAE;AAJX,CAPQ,EAaR;AACIH,EAAAA,QAAQ,EAAC,wBADb;AAEIC,EAAAA,QAAQ,EAAE,YAFd;AAGIC,EAAAA,KAAK,EAAE,cAHX;AAIIC,EAAAA,KAAK,EAAE;AAJX,CAbQ,EAmBR;AACIH,EAAAA,QAAQ,EAAC,wBADb;AAEIC,EAAAA,QAAQ,EAAE,YAFd;AAGIC,EAAAA,KAAK,EAAE,cAHX;AAIIC,EAAAA,KAAK,EAAE;AAJX,CAnBQ,CAAZ;AA0BAL,IAAI,CAACO,MAAL,CAAY,aAAZ,EAA2BC,KAA3B,CAAiC,GAAjC,EAAsC;AAACP,EAAAA,IAAD;AAAMQ,EAAAA,WAAW,EAAE,WAAnB;AAA+BC,EAAAA,YAAY,EAAC;AAA5C,CAAtC;AACAV,IAAI,CAACO,MAAL,CAAY,gBAAZ,EAA8BC,KAA9B,CAAoC,GAApC,EAAyC;AAACG,EAAAA,OAAO,EAAE;AAAV,CAAzC;AAEAX,IAAI,CAACO,MAAL,CAAY,eAAZ,EAA6BC,KAA7B,CAAmC,GAAnC,EAAuC;AAACP,EAAAA,IAAD;AAAMQ,EAAAA,WAAW,EAAE,WAAnB;AAA+BC,EAAAA,YAAY,EAAC;AAA5C,CAAvC;AAEAV,IAAI,CAACY,KAAL,CAAW,QAAX,EAAqBJ,KAArB,CAA2B,GAA3B,EAAgC;AAACF,EAAAA;AAAD,CAAhC;AACA;AACA;AACA;;AAIA,eAAe,MAAMO,GAAN,CAAU;AACrBC,EAAAA,WAAW,CAACC,OAAO,GAAG,EAAX,EAAe;AACtB,SAAKC,MAAL,GAAcD,OAAO,CAACC,MAAR,IAAkBjB,KAAK,CAACkB,MAAN,EAAhC;AACA,SAAKC,KAAL,GAAaH,OAAO,CAACG,KAArB;AACA,SAAKR,YAAL,GAAoBK,OAAO,CAACL,YAA5B;AACA,SAAKS,cAAL,GAAsB,IAAtB;AAEA,SAAKH,MAAL,CAAYI,YAAZ,CAAyBC,OAAzB,CAAiCC,GAAjC,CACIC,MAAM,IAAI;AACN,UAAI,CAAC,KAAKL,KAAV,EAAiB;AACb,eAAOK,MAAP;AACH;;AAED,YAAMC,SAAS,GAAG;AACdC,QAAAA,OAAO,EAAC,EADM;AAEd,WAAGF;AAFW,OAAlB;AAKAC,MAAAA,SAAS,CAACC,OAAV,CAAkBC,aAAlB,GAAmC,UAAS,KAAKR,KAAM,EAAvD;AACA,aAAOM,SAAP;AACH,KAbL,EAcIG,CAAC,IAAIC,OAAO,CAACC,MAAR,CAAeF,CAAf,CAdT;AAiBA,SAAKX,MAAL,CAAYI,YAAZ,CAAyBU,QAAzB,CAAkCR,GAAlC,CACIS,CAAC,IAAIA,CADT,EAEI,MAAMC,KAAN,IAAe;AACX,WAAKtB,YAAL,GAAoBuB,YAAY,CAACC,OAAb,CAAqB,eAArB,CAApB;;AACA,UACI,CAAC,KAAKxB,YAAN,IACAsB,KAAK,CAACF,QAAN,CAAeK,MAAf,KAA0B,GAD1B,IAEAH,KAAK,CAACT,MAAN,CAAaa,KAHjB,EAIE;AACE,cAAMJ,KAAN;AACH;;AAED,UAAI,CAAC,KAAKb,cAAV,EAA0B;AACtB,aAAKA,cAAL,GAAsB,KAAKH,MAAL,CAAYqB,IAAZ,CAAiB,eAAjB,EAAkC;AACpD3B,UAAAA,YAAY,EAAE,KAAKA;AADiC,SAAlC,CAAtB;AAGH;;AACD,YAAM;AAAE4B,QAAAA;AAAF,UAAW,MAAM,KAAKnB,cAA5B;AACA,WAAKD,KAAL,GAAaoB,IAAI,CAACpB,KAAlB;AACAe,MAAAA,YAAY,CAACM,OAAb,CAAqB,eAArB,EAAqCD,IAAI,CAAC5B,YAA1C;AACA,WAAKA,YAAL,GAAoB4B,IAAI,CAAC5B,YAAzB;AACA,YAAM8B,UAAU,GAAG,EACf,GAAGR,KAAK,CAACT,MADM;AAEfa,QAAAA,KAAK,EAAE;AAFQ,OAAnB;AAKA,aAAO,KAAKpB,MAAL,CAAYwB,UAAZ,CAAP;AACH,KA3BL;AA6BH;;AAEU,QAALC,KAAK,CAAC;AAAEA,IAAAA,KAAF;AAASC,IAAAA;AAAT,GAAD,EAAsB;AAC7B,UAAM;AAAEJ,MAAAA;AAAF,QAAW,MAAM,KAAKtB,MAAL,CAAYqB,IAAZ,CAAiB,aAAjB,EAAgC;AAAEI,MAAAA,KAAF;AAASC,MAAAA;AAAT,KAAhC,CAAvB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA,SAAK1B,KAAL,GAAaoB,IAAI,CAACpB,KAAlB;AACAe,IAAAA,YAAY,CAACM,OAAb,CAAqB,eAArB,EAAqCD,IAAI,CAAC5B,YAA1C;AACA,SAAKA,YAAL,GAAoBuB,YAAY,CAACC,OAAb,CAAqB,eAArB,CAApB;AACA,WAAOI,IAAI,CAACrC,IAAZ;AACH;;AAED4C,EAAAA,MAAM,GAAG;AACL,SAAK3B,KAAL,GAAa,IAAb;AACA,SAAKR,YAAL,GAAoB,IAApB;AACAuB,IAAAA,YAAY,CAACa,UAAb,CAAwB,eAAxB;AACH;;AAEa,QAARC,QAAQ,CAACT,IAAI,GAAC,EAAN,EAAU;AACpB,WAAO,MAAM,KAAKtB,MAAL,CAAYqB,IAAZ,CAAiB,gBAAjB,EAAmCC,IAAnC,EAAyCU,IAAzC,CAA8CjB,CAAC,IAAIA,CAAnD,CAAb;AACH;;AAEDkB,EAAAA,QAAQ,GAAG;AACP,WAAO,KAAKjC,MAAL,CAAY,QAAZ,EAAsBgC,IAAtB,CAA4BV,IAAD,IAAWA,IAAtC,CAAP;AACH;;AA5EoB","sourcesContent":["import MockAdapter from \"axios-mock-adapter\";\nimport axios from \"axios\";\n\n// {delayResponse:2000}\nconst mock = new MockAdapter(axios);\nconst user = {\n    fullName:'Mr. FabiozZz Loucoster',\n    birthDay: '20/10/1989',\n    phone: '+79996569772',\n    email: 'fabiozzz.dev@gmail.com',\n}\nconst users=[\n    {\n        fullName:'Mr. FabiozZz Loucoster',\n        birthDay: '20/10/1989',\n        phone: '+79996569772',\n        email: 'fabiozzz.dev@gmail.com',\n    },\n    {\n        fullName:'Mr. FabiozZz Loucoster',\n        birthDay: '20/10/1989',\n        phone: '+79996569772',\n        email: 'fabiozzz.dev@gmail.com',\n    },\n    {\n        fullName:'Mr. FabiozZz Loucoster',\n        birthDay: '20/10/1989',\n        phone: '+79996569772',\n        email: 'fabiozzz.dev@gmail.com',\n    },\n    {\n        fullName:'Mr. FabiozZz Loucoster',\n        birthDay: '20/10/1989',\n        phone: '+79996569772',\n        email: 'fabiozzz.dev@gmail.com',\n    },\n]\nmock.onPost('/auth/login').reply(200, {user,accessToken: 'TOKEN_ACC',refreshToken:'TOKEN_REF'});\nmock.onPost('/auth/register').reply(200, {success: 'Ok'});\n\nmock.onPost('/auth/refresh').reply(200,{user,accessToken: 'TOKEN_ACC',refreshToken:'TOKEN_REs'});\n\nmock.onGet('/users').reply(200, {users});\n/**\n * response на логин token & refreshToken\n */\n\n\n\nexport default class Api {\n    constructor(options = {}) {\n        this.client = options.client || axios.create();\n        this.token = options.token;\n        this.refreshToken = options.refreshToken;\n        this.refreshRequest = null;\n\n        this.client.interceptors.request.use(\n            config => {\n                if (!this.token) {\n                    return config;\n                }\n\n                const newConfig = {\n                    headers:{},\n                    ...config,\n                };\n\n                newConfig.headers.Authorization = `Bearer ${this.token}`;\n                return newConfig;\n            },\n            e => Promise.reject(e)\n        );\n\n        this.client.interceptors.response.use(\n            r => r,\n            async error => {\n                this.refreshToken = localStorage.getItem('refresh_token')\n                if (\n                    !this.refreshToken ||\n                    error.response.status !== 401 ||\n                    error.config.retry\n                ) {\n                    throw error;\n                }\n\n                if (!this.refreshRequest) {\n                    this.refreshRequest = this.client.post(\"/auth/refresh\", {\n                        refreshToken: this.refreshToken,\n                    });\n                }\n                const { data } = await this.refreshRequest;\n                this.token = data.token;\n                localStorage.setItem('refresh_token',data.refreshToken)\n                this.refreshToken = data.refreshToken;\n                const newRequest = {\n                    ...error.config,\n                    retry: true,\n                };\n\n                return this.client(newRequest);\n            }\n        );\n    }\n\n    async login({ login, password }) {\n        const { data } = await this.client.post(\"/auth/login\", { login, password });\n        console.log('вызван логин ')\n        this.token = data.token;\n        localStorage.setItem('refresh_token',data.refreshToken)\n        this.refreshToken = localStorage.getItem('refresh_token');\n        return data.user\n    }\n\n    logout() {\n        this.token = null;\n        this.refreshToken = null;\n        localStorage.removeItem('refresh_token')\n    }\n\n    async register(data={}) {\n        return await this.client.post('/auth/register', data).then(r => r);\n    }\n\n    getUsers() {\n        return this.client(\"/users\").then((data ) => data);\n    }\n}"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import axios from \"axios\";\nimport MockAdapter from \"axios-mock-adapter\";\nconst mock = new MockAdapter(axios, {\n  delayResponse: 5000\n});\nconst user = {\n  surName: 'FabiozZz',\n  name: 'Mr.',\n  patronymic: 'Loucoster',\n  birthDay: '20/10/1989',\n  phone: '+79996569772',\n  email: 'fabiozzz.dev@gmail.com'\n};\nconst baseUrl = \"http://localhost:4000/api\";\nmock.onGet(`${baseUrl}/protected_resource`).reply(200);\nmock.onPost(`${baseUrl}/auth/signup`).reply(200, {\n  user,\n  accessToken: 'ACCESS_TOKEN',\n  refreshToken: 'REFRESH_TOKEN'\n}); //request interceptor to add the auth token header to requests\n\naxios.interceptors.request.use(config => {\n  const accessToken = localStorage.getItem(\"accessToken\");\n\n  if (accessToken) {\n    config.headers[\"Authorization\"] = `Bearer ${accessToken}`;\n  }\n\n  return config;\n}, error => {\n  Promise.reject(error).then(r => r);\n}); //response interceptor to refresh token on receiving token expired error\n\naxios.interceptors.response.use(response => {\n  return response;\n}, function (error) {\n  const originalRequest = error.config;\n  let refreshToken = localStorage.getItem(\"refreshToken\");\n\n  if (refreshToken && error.response.status === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    return axios.post(`${baseUrl}/auth/refresh_token`, {\n      refreshToken: refreshToken\n    }).then(res => {\n      if (res.status === 200) {\n        localStorage.setItem(\"accessToken\", res.data.accessToken);\n        console.log(\"Access token refreshed!\");\n        return axios(originalRequest);\n      }\n    });\n  }\n\n  return Promise.reject(error);\n}); //functions to make api calls\n\nconst api = {\n  signup: body => {\n    return axios.post(`${baseUrl}/auth/signup`, body);\n  },\n  login: body => {\n    return axios.post(`${baseUrl}/auth/login`, body);\n  },\n  refreshToken: body => {\n    return axios.post(`${baseUrl}/auth/refresh_token`, body);\n  },\n  logout: body => {\n    return axios.delete(`${baseUrl}/auth/logout`, body);\n  },\n  getProtected: () => {\n    return axios.get(`${baseUrl}/protected_resource`);\n  }\n};\nexport default api;","map":{"version":3,"sources":["/home/fabiozzz/www/react/y-champion/for-user/src/Api/api.js"],"names":["axios","MockAdapter","mock","delayResponse","user","surName","name","patronymic","birthDay","phone","email","baseUrl","onGet","reply","onPost","accessToken","refreshToken","interceptors","request","use","config","localStorage","getItem","headers","error","Promise","reject","then","r","response","originalRequest","status","_retry","post","res","setItem","data","console","log","api","signup","body","login","logout","delete","getProtected","get"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport MockAdapter from \"axios-mock-adapter\";\n\nconst mock = new MockAdapter(axios,{delayResponse:5000})\nconst user = {\n    surName:'FabiozZz',\n    name:'Mr.',\n    patronymic:'Loucoster',\n    birthDay: '20/10/1989',\n    phone: '+79996569772',\n    email: 'fabiozzz.dev@gmail.com',\n}\nconst baseUrl = \"http://localhost:4000/api\";\n\nmock.onGet(`${baseUrl}/protected_resource`).reply(200,)\nmock.onPost(`${baseUrl}/auth/signup`).reply(200,{user,accessToken:'ACCESS_TOKEN',refreshToken:'REFRESH_TOKEN'})\n//request interceptor to add the auth token header to requests\naxios.interceptors.request.use(\n    (config) => {\n        const accessToken = localStorage.getItem(\"accessToken\");\n        if (accessToken) {\n            config.headers[\"Authorization\"] = `Bearer ${accessToken}`;\n        }\n        return config;\n    },\n    (error) => {\n        Promise.reject(error).then(r => r);\n    }\n);\n//response interceptor to refresh token on receiving token expired error\naxios.interceptors.response.use(\n    (response) => {\n        return response;\n    },\n    function (error) {\n        const originalRequest = error.config;\n        let refreshToken = localStorage.getItem(\"refreshToken\");\n        if (\n            refreshToken &&\n            error.response.status === 401 &&\n            !originalRequest._retry\n        ) {\n            originalRequest._retry = true;\n            return axios\n                .post(`${baseUrl}/auth/refresh_token`, { refreshToken: refreshToken })\n                .then((res) => {\n                    if (res.status === 200) {\n                        localStorage.setItem(\"accessToken\", res.data.accessToken);\n                        console.log(\"Access token refreshed!\");\n                        return axios(originalRequest);\n                    }\n                });\n        }\n        return Promise.reject(error);\n    }\n);\n//functions to make api calls\nconst api = {\n    signup: (body) => {\n        return axios.post(`${baseUrl}/auth/signup`, body);\n    },\n    login: (body) => {\n        return axios.post(`${baseUrl}/auth/login`, body);\n    },\n    refreshToken: (body) => {\n        return axios.post(`${baseUrl}/auth/refresh_token`, body);\n    },\n    logout: (body) => {\n        return axios.delete(`${baseUrl}/auth/logout`, body);\n    },\n    getProtected: () => {\n        return axios.get(`${baseUrl}/protected_resource`);\n    },\n};\nexport default api;\n"]},"metadata":{},"sourceType":"module"}